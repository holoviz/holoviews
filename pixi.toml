[project]
name = "holoviews"
channels = ["conda-forge", "pyviz/label/dev"]
platforms = ["linux-64", "osx-arm64", "osx-64", "win-64"]

[tasks]
check-latest-packages = 'python scripts/check_latest_packages.py'
download-data = 'bash scripts/download_data.sh'

[environments]
test-309 = ["py309", "test-core", "test", "example", "test-example"]
test-310 = ["py310", "test-core", "test", "example", "test-example"]
test-311 = ["py311", "test-core", "test", "example", "test-example"]
test-312 = ["py312", "test-core", "test", "example", "test-example"]
test-ui = ["py312", "test-core", "test", "test-ui"]
test-core = ["py312", "test-core"]
docs = ["py311", "example", "doc"]

[dependencies]
python = ">=3.9"
param = ">=1.12.0,<3.0"
panel = ">=1.0"
pyviz_comms = ">=2.1"
colorcet = "*"
numpy = ">=1.0"
packaging = "*"
pandas = ">=0.20.0"
# Recommended
ipython = ">=5.4.0"
notebook = "*"
matplotlib-base = ">=3"
bokeh = ">=3.1"

[pypi-dependencies]
holoviews = { path = "." }

[feature.py309.dependencies]
python = "3.9.*"

[feature.py310.dependencies]
python = "3.10.*"

[feature.py311.dependencies]
python = "3.11.*"

[feature.py312.dependencies]
python = "3.12.*"

[feature.example.dependencies]
networkx = "*"
pillow = "*"
xarray = ">=0.10.4"
plotly = ">=4.0"
# dash >=1.16
streamz = ">=0.5.0"
ffmpeg = "*"
cftime = "*"
netcdf4 = "*"
dask-core = "*"
scipy = "*"
shapely = "*"
scikit-image = "*"
pyarrow = "*"
pooch = "*"
datashader = ">=0.11.1"
notebook = ">=7.0"

# =============================================
# =================== TESTS ===================
# =============================================
[feature.test-core.dependencies]
pytest = "*"
pytest-cov = "*"
pytest-rerunfailures = "*"
nbconvert = "*"
pillow = "*"
plotly = ">=4.0"
contourpy = "*"
pytest-github-actions-annotate-failures = "*"

[feature.test-core.tasks]
test-unit = 'pytest holoviews'

[feature.test.dependencies]
dask-core = "*"
ibis-sqlite = "*"
xarray = ">=0.10.4"
networkx = "*"
shapely = "*"
ffmpeg = "*"
cftime = "*"
scipy = ">=1.10" # Python 3.9 + Windows downloads 1.9
selenium = "*"
spatialpandas = "*"
datashader = ">=0.11.1"
codecov = "*"
# dash >=1.16
# tsdownsample = "*"  # not windows

[feature.test-example.tasks]
test-example = 'pytest -n auto --dist loadscope --nbval-lax examples'

[feature.test-example.dependencies]
nbval = "*"
pytest-xdist = "*"

[feature.test-ui]
channels = ["conda-forge", "pyviz/label/dev", "microsoft"]

[feature.test-ui.dependencies]
playwright = "*"
pytest-playwright = "*"

[feature.test-ui.tasks]
install-ui = 'playwright install chromium'

[feature.test-ui.tasks.test-ui]
cmd = 'pytest holoviews/tests/ui --ui --browser chromium'
depends_on = ["install-ui"]

# =============================================
# =================== DOCS ====================
# =============================================
[feature.doc.dependencies]
nbsite = ">=0.8.4,<0.9.0"
graphviz = "*"
pooch = "*"
selenium = "*"

[feature.doc.tasks]
generate-rst = 'nbsite generate-rst --org holoviz --project-name holoviews'
refmanual = 'python ./doc/generate_modules.py holoviews -d ./doc/reference_manual -n holoviews -e tests'
build-docs = 'nbsite build --what=html --output=builtdocs --org holoviz --project-name holoviews'

[feature.doc.tasks.build]
depends_on = ['generate-rst', 'refmanual', 'build-docs']
