name: Pixi lock
description: Get or create the pixi.lock
inputs:
  cache:
    description: Whether to enable caching of the lock-file
    required: true
    default: "true"

runs:
  using: "composite"
  steps:
    - name: Set TODAY
      run: |
        echo "TODAY=$(date +'%Y-%m-%d')" >> $GITHUB_ENV
    - uses: actions/checkout@v4
      with:
        fetch-depth: "1"
    - uses: actions/checkout@v4
      with:
        fetch-depth: "1"
    - name: cache
    - if: inputs.cache == 'true'
      id: cache
      uses: actions/cache/restore@v4
      with:
        path: pixi.lock
        key: pixi|${{ env.TODAY }}|${{ hashFiles('pixi.toml') }}
    - uses: prefix-dev/setup-pixi@v0.5.1
      if: steps.cache.outputs.cache-hit != 'true'
      id: install
      with:
        pixi-version: v0.19.0
        manifest-path: pixi.toml
        environments: ${{ matrix.environment }}
    - uses: actions/upload-artifact@v4
      with:
        name: pixi-lock
        path: pixi.lock
        if-no-files-found: error
    - if: inputs.cache == 'true' && steps.cache.outputs.cache-hit != 'true'
      uses: actions/cache/save@v4
      with:
        path: pixi.lock
        key: pixi|${{ env.TODAY }}|${{ hashFiles('pixi.toml') }}
